{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Michael\\\\Documents\\\\GitHub\\\\fromagent\\\\client\\\\src\\\\pages\\\\login.jsx\",\n    _s = $RefreshSig$();\n\nimport React, { useEffect } from 'react';\nimport { useState } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { LOGIN_PATH, RESUME_SESSION_PATH } from '../consts/api.const';\nimport { useAuthState } from '../authentication/authcontext.jsx';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function LoginPage() {\n  _s();\n\n  const [credentials, setCredentials] = useState({});\n  const [AuthState, dispatchAuthState] = useAuthState();\n  const [fetching, setFetching] = useState(false);\n  const [loadingSession, setLoadingSession] = useState(true);\n  const [forgetPW, setForgetPW] = useState(false);\n  const navigate = useNavigate();\n\n  async function handleSubmit(event) {\n    event.preventDefault();\n    setFetching(true);\n    const user = credentials;\n    const response = await fetch(LOGIN_PATH, {\n      method: \"POST\",\n      credentials: \"include\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify({\n        user\n      })\n    }).catch(error => {\n      window.alert(error);\n      return;\n    });\n    const res = await response.json().then(setFetching(false));\n\n    if (res.status === \"Correct Password\") {\n      dispatchAuthState({\n        type: \"LOGIN\",\n        user: res.user\n      });\n    } else alert(res.status); // Todos post item to backend server\n\n  }\n\n  function handleChange(event) {\n    setCredentials({ ...credentials,\n      [event.target.name]: event.target.value\n    });\n  }\n\n  function getQueryVariable(variable) {\n    var query = window.location.search.substring(1);\n    var vars = query.split(\"&\");\n\n    for (var i = 0; i < vars.length; i++) {\n      var pair = vars[i].split(\"=\");\n\n      if (pair[0] == variable) {\n        return pair[1];\n      }\n    }\n\n    return false;\n  }\n\n  const query = getQueryVariable('from');\n  useEffect(() => {\n    if (AuthState.isLoggedIn) {\n      if (AuthState.recruitmentTarget === undefined || AuthState.profitTarget === undefined) {\n        navigate(\"/yearlytarget\");\n      } else {\n        if (query) {\n          navigate(query);\n        } else {\n          navigate(\"/dashboard\");\n        }\n      }\n    }\n  }, [AuthState]);\n  useEffect(() => {\n    async function resumeSession() {\n      setLoadingSession(true);\n      await fetch(RESUME_SESSION_PATH, {\n        method: \"POST\",\n        credentials: \"include\",\n        headers: {\n          \"Content-Type\": \"application/json\"\n        }\n      }).then(res => {\n        if (res.ok) {\n          return res.json();\n        }\n      }).then(json => {\n        if (json.found === true) {\n          dispatchAuthState({\n            type: \"LOGIN\",\n            user: json.user\n          });\n        }\n      }).catch(error => {\n        console.log(error);\n        return error;\n      }).finally(() => {\n        setLoadingSession(false);\n      });\n    }\n\n    resumeSession();\n  }, []);\n\n  const forget = () => {\n    setForgetPW(true);\n  };\n\n  if (loadingSession) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      children: \"\\u8F09\\u5165\\u4E2D...\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 124,\n      columnNumber: 13\n    }, this);\n  } else if (!forgetPW) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"d-flex flex-column align-items-center justify-content-center h-100\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"abcd\",\n        style: {\n          fontSize: \"30px\"\n        },\n        children: \"\\u5BA2\\u6236\\u53CA\\u62DB\\u52DF\\u7BA1\\u7406\\u7CFB\\u7D71\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 130,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(\"form\", {\n        onSubmit: handleSubmit,\n        className: \"w-90\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"border primary p-3 pb-4 mt-3 rounded\",\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"form-group d-flex flex-column\",\n            children: [/*#__PURE__*/_jsxDEV(\"label\", {\n              children: \"\\u7528\\u6236\\u540D\\u7A31\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 135,\n              columnNumber: 21\n            }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n              type: \"text\",\n              className: \"form-control shadow-sm \",\n              name: \"username\",\n              onChange: handleChange\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 136,\n              columnNumber: 21\n            }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n              className: \"mt-3\",\n              children: \"\\u5BC6\\u78BC\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 137,\n              columnNumber: 21\n            }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n              type: \"password\",\n              className: \"form-control shadow-sm \",\n              name: \"password\",\n              onChange: handleChange\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 138,\n              columnNumber: 21\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 134,\n            columnNumber: 17\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 133,\n          columnNumber: 4\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"form-group d-flex flex-column mt-3\",\n          children: /*#__PURE__*/_jsxDEV(\"input\", {\n            className: \"btn btn-light\",\n            type: \"submit\",\n            disabled: fetching,\n            value: !fetching ? \"登入\" : \"登入中...\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 142,\n            columnNumber: 5\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 141,\n          columnNumber: 4\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 132,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"w-90\",\n        children: /*#__PURE__*/_jsxDEV(\"a\", {\n          className: \"float-start mt-3 forgetPW\",\n          onClick: forget,\n          children: \"\\u5FD8\\u8A18\\u5BC6\\u78BC\\uFF1F\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 147,\n          columnNumber: 17\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 146,\n        columnNumber: 13\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 129,\n      columnNumber: 9\n    }, this);\n  } else if (forgetPW) {\n    /*#__PURE__*/\n    _jsxDEV(\"div\", {\n      className: \"d-flex flex-column align-items-center justify-content-center h-100\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"abcd\",\n        style: {\n          fontSize: \"30px\"\n        },\n        children: \"\\u5BA2\\u6236\\u53CA\\u62DB\\u52DF\\u7BA1\\u7406\\u7CFB\\u7D71\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 153,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(\"form\", {\n        onSubmit: handleSubmit,\n        className: \"w-90\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"border primary p-3 pb-4 mt-3 rounded\",\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"form-group d-flex flex-column\",\n            children: [/*#__PURE__*/_jsxDEV(\"label\", {\n              children: \"\\u7528\\u6236\\u540D\\u7A31\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 158,\n              columnNumber: 21\n            }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n              type: \"text\",\n              className: \"form-control shadow-sm \",\n              name: \"username\",\n              onChange: handleChange\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 159,\n              columnNumber: 21\n            }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n              className: \"mt-3\",\n              children: \"\\u5BC6\\u78BC\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 160,\n              columnNumber: 21\n            }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n              type: \"password\",\n              className: \"form-control shadow-sm \",\n              name: \"password\",\n              onChange: handleChange\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 161,\n              columnNumber: 21\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 157,\n            columnNumber: 17\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 156,\n          columnNumber: 4\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"form-group d-flex flex-column mt-3\",\n          children: /*#__PURE__*/_jsxDEV(\"input\", {\n            className: \"btn btn-light\",\n            type: \"submit\",\n            disabled: fetching,\n            value: !fetching ? \"登入\" : \"登入中...\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 165,\n            columnNumber: 5\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 164,\n          columnNumber: 4\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 155,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"w-90\",\n        children: /*#__PURE__*/_jsxDEV(\"a\", {\n          className: \"float-start mt-3 forgetPW\",\n          onClick: forget,\n          children: \"\\u5FD8\\u8A18\\u5BC6\\u78BC\\uFF1F\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 170,\n          columnNumber: 17\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 169,\n        columnNumber: 13\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 152,\n      columnNumber: 9\n    }, this);\n  }\n\n  ;\n}\n\n_s(LoginPage, \"x0lSxEffRP5+fVODb4Hzt1l6pGE=\", false, function () {\n  return [useAuthState, useNavigate];\n});\n\n_c = LoginPage;\n\nvar _c;\n\n$RefreshReg$(_c, \"LoginPage\");","map":{"version":3,"sources":["C:/Users/Michael/Documents/GitHub/fromagent/client/src/pages/login.jsx"],"names":["React","useEffect","useState","useNavigate","LOGIN_PATH","RESUME_SESSION_PATH","useAuthState","LoginPage","credentials","setCredentials","AuthState","dispatchAuthState","fetching","setFetching","loadingSession","setLoadingSession","forgetPW","setForgetPW","navigate","handleSubmit","event","preventDefault","user","response","fetch","method","headers","body","JSON","stringify","catch","error","window","alert","res","json","then","status","type","handleChange","target","name","value","getQueryVariable","variable","query","location","search","substring","vars","split","i","length","pair","isLoggedIn","recruitmentTarget","undefined","profitTarget","resumeSession","ok","found","console","log","finally","forget","fontSize"],"mappings":"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","sourcesContent":["import React, { useEffect } from 'react';\r\nimport { useState } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { LOGIN_PATH, RESUME_SESSION_PATH } from '../consts/api.const';\r\nimport { useAuthState } from '../authentication/authcontext.jsx';\r\n\r\nexport default function LoginPage(){\r\n\r\n    const [credentials, setCredentials] = useState({});\r\n    const [AuthState, dispatchAuthState] = useAuthState();\r\n    const [fetching, setFetching] = useState(false);\r\n    const [loadingSession, setLoadingSession] = useState(true);\r\n    const [forgetPW, setForgetPW] = useState(false);\r\n    const navigate = useNavigate();\r\n    \r\n    async function handleSubmit(event) {\r\n        event.preventDefault();\r\n        setFetching(true);\r\n        const user = credentials;\r\n        const response = await fetch(LOGIN_PATH, {\r\n            method: \"POST\",\r\n            credentials: \"include\",\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n            },\r\n            body: JSON.stringify({user}),\r\n        })\r\n        .catch(\r\n            error => {\r\n                window.alert(error);\r\n                return;\r\n            }\r\n        ); \r\n\r\n        const res = await response.json().then(setFetching(false));\r\n        \r\n        if (res.status === \"Correct Password\") {\r\n            dispatchAuthState(\r\n                {\r\n                    type: \"LOGIN\",\r\n                    user: res.user\r\n                }\r\n            );            \r\n        }\r\n        else alert(res.status);\r\n\r\n        // Todos post item to backend server\r\n    }\r\n\r\n    function handleChange(event){\r\n        setCredentials({ ...credentials, [event.target.name]: event.target.value });\r\n    }\r\n\t\r\n\tfunction getQueryVariable(variable)\r\n\t{\r\n\t\t\tvar query = window.location.search.substring(1);\r\n\t\t\tvar vars = query.split(\"&\");\r\n\t\t\tfor (var i=0;i<vars.length;i++) {\r\n\t\t\t\t\t\tvar pair = vars[i].split(\"=\");\r\n\t\t\tif(pair[0] == variable){return pair[1];}\r\n\t\t\t}\r\n\t\t\treturn(false);\r\n\t}\r\n\t\r\n\tconst query=(getQueryVariable('from'));\r\n    useEffect( () => {\r\n        if (AuthState.isLoggedIn) {\r\n            if (AuthState.recruitmentTarget === undefined || AuthState.profitTarget === undefined){\r\n                navigate(\"/yearlytarget\");\r\n            } else \r\n            {\r\n\t\t\t\tif(query){\r\n\t\t\t\t\tnavigate(query);\r\n\t\t\t\t}else{\r\n\t\t\t\t\tnavigate(\"/dashboard\");\r\n\t\t\t\t}\r\n            }\r\n        }\r\n    },[AuthState]);\r\n\r\n    useEffect(() => {\r\n        async function resumeSession(){\r\n            setLoadingSession(true);\r\n            await fetch(RESUME_SESSION_PATH, {\r\n                method: \"POST\",\r\n                credentials: \"include\",\r\n                headers: {\r\n                    \"Content-Type\": \"application/json\"\r\n                }\r\n            })\r\n            .then(\r\n                res => {\r\n                    if (res.ok){\r\n                        return (res.json());\r\n                    }\r\n                }\r\n            ).then(\r\n                json => {\r\n                    if (json.found === true){\r\n                        dispatchAuthState({\r\n                            type: \"LOGIN\",\r\n                            user: json.user\r\n                        })\r\n                    }\r\n                }\r\n            ).catch(\r\n                error => {\r\n                    console.log(error);\r\n                    return (error);\r\n                }\r\n            ).finally(() => {\r\n                setLoadingSession(false);\r\n            })\r\n        }\r\n        resumeSession();\r\n    }, []);\r\n\r\n    const forget = () =>{\r\n        setForgetPW(true);\r\n    }\r\n\r\n    if (loadingSession){\r\n        return (\r\n            <div>\r\n                載入中...\r\n            </div>\r\n        );\r\n    } else if(!forgetPW){ return (\r\n        <div className='d-flex flex-column align-items-center justify-content-center h-100'>\r\n            <div className='abcd' style={{ fontSize: \"30px\" }}>客戶及招募管理系統</div>\r\n\t\t\t\r\n            <form onSubmit={handleSubmit} className=\"w-90\">\r\n\t\t\t<div className=\"border primary p-3 pb-4 mt-3 rounded\">\r\n                <div className='form-group d-flex flex-column'>\r\n                    <label>用戶名稱</label>\r\n                    <input type=\"text\" className='form-control shadow-sm ' name='username' onChange={handleChange} />\r\n                    <label className=\"mt-3\">密碼</label>\r\n                    <input type=\"password\" className='form-control shadow-sm ' name='password' onChange={handleChange}/>\r\n                </div>\r\n\t\t\t</div>\r\n\t\t\t<div className='form-group d-flex flex-column mt-3'>\r\n\t\t\t\t<input className='btn btn-light' type=\"submit\" disabled={fetching} value={!fetching? \"登入\": \"登入中...\"}/>\r\n\t\t\t</div>\r\n            </form>\r\n\r\n            <div className='w-90'>\r\n                <a className='float-start mt-3 forgetPW' onClick={forget}>忘記密碼？</a>\r\n            </div>\r\n        </div>\r\n    )}\r\n    else if(forgetPW){\r\n        <div className='d-flex flex-column align-items-center justify-content-center h-100'>\r\n            <div className='abcd' style={{ fontSize: \"30px\" }}>客戶及招募管理系統</div>\r\n\t\t\t\r\n            <form onSubmit={handleSubmit} className=\"w-90\">\r\n\t\t\t<div className=\"border primary p-3 pb-4 mt-3 rounded\">\r\n                <div className='form-group d-flex flex-column'>\r\n                    <label>用戶名稱</label>\r\n                    <input type=\"text\" className='form-control shadow-sm ' name='username' onChange={handleChange} />\r\n                    <label className=\"mt-3\">密碼</label>\r\n                    <input type=\"password\" className='form-control shadow-sm ' name='password' onChange={handleChange}/>\r\n                </div>\r\n\t\t\t</div>\r\n\t\t\t<div className='form-group d-flex flex-column mt-3'>\r\n\t\t\t\t<input className='btn btn-light' type=\"submit\" disabled={fetching} value={!fetching? \"登入\": \"登入中...\"}/>\r\n\t\t\t</div>\r\n            </form>\r\n\r\n            <div className='w-90'>\r\n                <a className='float-start mt-3 forgetPW' onClick={forget}>忘記密碼？</a>\r\n            </div>\r\n        </div>\r\n    }\r\n    ;\r\n\r\n}\r\n"]},"metadata":{},"sourceType":"module"}