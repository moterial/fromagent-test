{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Michael\\\\Documents\\\\GitHub\\\\fromagent\\\\client\\\\src\\\\pages\\\\settings.jsx\",\n    _s = $RefreshSig$();\n\nimport React, { useEffect } from 'react';\nimport { useState } from 'react';\nimport { Routes, Route, Link } from 'react-router-dom';\nimport { useAuthState } from '../authentication/authcontext.jsx';\nimport UserManagementPage from './usermanagement.jsx';\nimport { GET_SECURITY, CHANGE_PASSWORD_PATH, GAPI_DELETE_USER, GAPI_GET_LINK, GAPI_GET_USER_TOKEN, USER_LOGOUT } from '../consts/api.const.js';\nimport { SocketContext, socket } from '../context/socket';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nfunction Settings() {\n  _s();\n\n  const [values, setValues] = useState({});\n  const [hasSecurity, setHasSecurity] = useState(false);\n  const [security, setSecurity] = useState({});\n  const [AuthState, dispatchAuthState] = useAuthState();\n  let popupWindow = null;\n  const question1 = [\"你的第一個寵物名字是？\", \"你的第一個車牌號碼是？\", \"你的第一個電話號碼是？\", \"你配偶的姓名是？\", \"你母親的姓名是？\", \"你父親的姓名是？\"];\n  const question2 = [\"你的出生地是？\", \"你的小學名字是？\", \"你的學號（或職員編號）是？\", \"對你影響最大的人名字是？\", \"你的最喜歡的運動是？\", \"你的最喜歡的食物是？\"];\n\n  const exportToGoogleCalendar = () => {\n    socket.emit(\"logingoogle\", AuthState.username);\n    console.log(GAPI_GET_LINK);\n    fetch(GAPI_GET_LINK, {\n      method: \"POST\",\n      credentials: \"include\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify(AuthState)\n    }).then(res => {\n      if (res.ok) {\n        return res.json();\n      }\n    }).then(json => {\n      if (json.status === \"success\") {\n        window.location.href = json.authUrl;\n      }\n    }).catch(error => {\n      console.log(\"Error: \" + error);\n    });\n  };\n\n  const showlogout = () => {\n    document.getElementById('logoutbtn').style.display = \"block\";\n    document.getElementById('g-logout-more').style.display = \"none\";\n  };\n\n  const logoutfromGoogleCalendar = () => {\n    if (window.confirm(\"確定要登出Google嗎？\")) {\n      fetch(GAPI_DELETE_USER, {\n        method: \"DELETE\",\n        credentials: \"include\",\n        headers: {\n          \"Content-Type\": \"application/json\"\n        },\n        body: JSON.stringify(AuthState)\n      }).then(res => {\n        if (res.ok) {\n          return res.json();\n        }\n      }).then(json => {\n        window.alert(json.status + \": \" + json.message);\n\n        if (json.status === \"success\") {\n          dispatchAuthState({\n            type: \"UPDATE\",\n            targets: {\n              token: false\n            }\n          });\n        }\n      }).catch(error => {\n        console.log(\"Error: \" + error);\n      });\n    }\n  };\n\n  const logout = () => {\n    fetch(USER_LOGOUT, {\n      method: \"POST\",\n      credentials: \"include\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify(AuthState)\n    }).then(res => {\n      if (res.ok) {\n        return res.json();\n      }\n    }).then(json => {\n      if (json.status === \"success\") {\n        alert(\"Successfully logged out\");\n        dispatchAuthState({\n          type: \"LOGOUT\"\n        });\n      }\n    }).catch(error => {\n      alert(error);\n      console.log(error);\n      return error;\n    });\n  };\n\n  const handleSubmit = async event => {\n    event.preventDefault();\n\n    if (values.newPw !== values.confirmNewPw) {\n      alert(\"New password and confirm new password are not equal\");\n      return;\n    }\n\n    const data = {\n      username: AuthState.username,\n      oldPassword: values.oldPw,\n      newPassword: values.newPw\n    };\n    await fetch(CHANGE_PASSWORD_PATH, {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify(data)\n    }).then(response => {\n      if (response.ok) {\n        return response.json();\n      }\n    }).then(res => {\n      alert(res.status + \": \" + res.message);\n    }).catch(error => {\n      alert(error);\n    });\n  };\n\n  const handleChange = e => {\n    setValues({ ...values,\n      [e.target.name]: e.target.value\n    });\n  };\n\n  useEffect(() => {\n    socket.on(\"forceRefresh\", data => {\n      fetch(GAPI_GET_USER_TOKEN, {\n        method: \"POST\",\n        credentials: \"include\",\n        headers: {\n          \"Content-Type\": \"application/json\"\n        }\n      }).then(res => {\n        if (res.ok) {\n          return res.json();\n        }\n      }).then(json => {\n        if (json.token === true) {\n          dispatchAuthState({\n            type: \"UPDATE\",\n            targets: {\n              token: true\n            }\n          });\n        }\n      }).catch(error => {\n        console.log(Error(error));\n      });\n    });\n  }, []);\n  useEffect(() => {\n    fetch(GET_SECURITY, {\n      method: \"POST\",\n      credentials: \"include\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify({\n        AuthState\n      })\n    }).then(res => {\n      if (res.ok) {\n        return res.json();\n      }\n    }).then(data => {\n      if (data.status === \"success\") {\n        const foundUser = data.body.foundUser;\n        console.log(foundUser);\n\n        if (foundUser.securityQuestion1 != null && foundUser.securityQuestion2 != null) {\n          console.log(\"has security\");\n          setHasSecurity(true);\n        }\n      }\n    });\n  }, []);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"bounceInAnimation d-flex justify-content-center\",\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"w-90 \",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"my-3 w-100 d-flex justify-content-center align-items-center\",\n        style: {\n          height: \"100px\"\n        },\n        children: !AuthState.token ? /*#__PURE__*/_jsxDEV(\"div\", {\n          children: /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"btn-primary-outline google-btn\",\n            type: \"button\",\n            onClick: exportToGoogleCalendar,\n            children: /*#__PURE__*/_jsxDEV(\"img\", {\n              src: \"/google-btn.png\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 249,\n              columnNumber: 33\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 248,\n            columnNumber: 29\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 247,\n          columnNumber: 25\n        }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n          align: \"center\",\n          children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n            children: \"\\u5DF2\\u6210\\u529F\\u9023\\u63A5Google\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 254,\n            columnNumber: 8\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: showlogout,\n            id: \"g-logout-more\",\n            children: /*#__PURE__*/_jsxDEV(\"h6\", {\n              children: [\"more \", /*#__PURE__*/_jsxDEV(\"span\", {\n                children: \"\\u25BC\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 255,\n                columnNumber: 65\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 255,\n              columnNumber: 56\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 255,\n            columnNumber: 8\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            id: \"logoutbtn\",\n            className: \"w-100 bg-light form-control shadow-sm border rounded h-50 google-btn\",\n            type: \"button\",\n            onClick: logoutfromGoogleCalendar,\n            children: \"\\u5F9E Google Calendar \\u767B\\u51FA\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 256,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 253,\n          columnNumber: 7\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 244,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"w-100 d-inline-flex flex-column align-items-center border p-3 pb-4 rounded\",\n        children: [/*#__PURE__*/_jsxDEV(\"label\", {\n          className: \"w-100 text-start\",\n          children: \"\\u66F4\\u6539\\u5BC6\\u78BC\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 265,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"form\", {\n          className: \"w-100 d-inline-flex flex-column align-items-center\",\n          onSubmit: handleSubmit,\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"form-group w-100 d-inline-flex flex-column align-items-center\",\n            children: [/*#__PURE__*/_jsxDEV(\"input\", {\n              className: \"form-control shadow-sm my-2\",\n              type: \"password\",\n              name: \"oldPw\",\n              placeholder: \"\\u820A\\u5BC6\\u78BC\",\n              onChange: handleChange\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 268,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n              className: \"form-control shadow-sm my-2\",\n              type: \"password\",\n              name: \"newPw\",\n              placeholder: \"\\u65B0\\u5BC6\\u78BC\",\n              onChange: handleChange\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 269,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n              className: \"form-control shadow-sm my-2\",\n              type: \"password\",\n              name: \"confirmNewPw\",\n              placeholder: \"\\u78BA\\u8A8D\\u65B0\\u5BC6\\u78BC\",\n              onChange: handleChange\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 270,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n              className: \"mt-1 btn btn-outline-light w-100\",\n              type: \"submit\",\n              value: \"\\u66F4\\u6539\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 271,\n              columnNumber: 29\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 267,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 266,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 264,\n        columnNumber: 17\n      }, this), hasSecurity == false ? /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"w-80 d-inline-flex flex-column align-items-center border p-3 pb-4 rounded mt-3\",\n        children: [/*#__PURE__*/_jsxDEV(\"label\", {\n          className: \"w-100 text-start\",\n          children: \"\\uFF01\\uFF01\\u8A2D\\u5B9A\\u5BC6\\u4FDD\\u554F\\u984C\\uFF01\\uFF01\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 277,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"form\", {\n          className: \"w-100 d-inline-flex flex-column align-items-center\",\n          onSubmit: handleSubmit,\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"form-group w-80 d-inline-flex flex-column align-items-center\",\n            children: [\"\\u554F\\u984C\\u4E00\\uFF1A\", /*#__PURE__*/_jsxDEV(\"select\", {\n              className: \"form-control shadow-sm my-2\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 280,\n              columnNumber: 33\n            }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n              className: \"form-control shadow-sm my-2\",\n              type: \"text\",\n              name: \"answer1\",\n              placeholder: \"\\u7B54\\u6848\",\n              onChange: handleChange\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 283,\n              columnNumber: 29\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 279,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"form-group w-80 d-inline-flex flex-column align-items-center\",\n            children: [\"\\u554F\\u984C\\u4E8C\\uFF1A\", /*#__PURE__*/_jsxDEV(\"select\", {\n              className: \"form-control shadow-sm my-2\",\n              children: [/*#__PURE__*/_jsxDEV(\"option\", {\n                value: \"1\",\n                children: \"\\u4F60\\u7684\\u51FA\\u751F\\u5730\\u662F\\uFF1F\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 288,\n                columnNumber: 33\n              }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n                value: \"2\",\n                children: \"\\u4F60\\u7684\\u5C0F\\u5B78\\u540D\\u662F\\uFF1F\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 289,\n                columnNumber: 33\n              }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n                value: \"3\",\n                children: \"\\u4F60\\u7684\\u5B78\\u865F\\uFF08\\u6216\\u8077\\u54E1\\u7DE8\\u865F\\uFF09\\u662F\\uFF1F\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 290,\n                columnNumber: 33\n              }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n                value: \"3\",\n                children: \"\\u4F60\\u73A9\\u904E\\u7684\\u7B2C\\u4E00\\u500B\\u6A02\\u5668\\u662F\\uFF1F\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 291,\n                columnNumber: 33\n              }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n                value: \"3\",\n                children: \"\\u4F60\\u7372\\u5F97\\u7684\\u7B2C\\u4E00\\u4EFD\\u5DE5\\u4F5C\\u662F\\uFF1F\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 292,\n                columnNumber: 33\n              }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n                value: \"3\",\n                children: \"\\u5C0D\\u4F60\\u5F71\\u97FF\\u6700\\u5927\\u7684\\u4EBA\\u540D\\u5B57\\u662F\\uFF1F\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 293,\n                columnNumber: 33\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 287,\n              columnNumber: 33\n            }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n              className: \"form-control shadow-sm my-2\",\n              type: \"text\",\n              name: \"answer2\",\n              placeholder: \"\\u7B54\\u6848\",\n              onChange: handleChange\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 295,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n              className: \"mt-1 btn btn-outline-light w-100\",\n              type: \"submit\",\n              value: \"\\u66F4\\u6539\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 296,\n              columnNumber: 29\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 286,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 278,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 276,\n        columnNumber: 41\n      }, this) : null, /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"w-100 container mt-3\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"row\",\n          children: [!!(AuthState.permissionLevel === 2) ? /*#__PURE__*/_jsxDEV(Link, {\n            to: \"usermanagement\",\n            className: \"col w-100 p-0 me-1\",\n            children: /*#__PURE__*/_jsxDEV(\"button\", {\n              className: \"btn btn-outline-light w-100 \",\n              children: \"\\u9032\\u5165\\u54E1\\u5DE5\\u7BA1\\u7406\\u9801\\u9762\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 312,\n              columnNumber: 33\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 311,\n            columnNumber: 29\n          }, this) : \"\", /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"col btn btn-light ms-1 p-0\",\n            type: \"button\",\n            onClick: logout,\n            children: \"\\u767B\\u51FA\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 315,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 309,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 308,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 243,\n      columnNumber: 13\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 242,\n    columnNumber: 9\n  }, this);\n}\n\n_s(Settings, \"jbkXpol6bQ2uQa3f817Yt58NkjE=\", false, function () {\n  return [useAuthState];\n});\n\n_c = Settings;\nexport default function SettingsPage(props) {\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: /*#__PURE__*/_jsxDEV(Routes, {\n      children: [/*#__PURE__*/_jsxDEV(Route, {\n        path: \"\",\n        element: /*#__PURE__*/_jsxDEV(Settings, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 326,\n          columnNumber: 41\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 326,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(Route, {\n        path: \"usermanagement\",\n        element: /*#__PURE__*/_jsxDEV(UserManagementPage, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 327,\n          columnNumber: 55\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 327,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 325,\n      columnNumber: 13\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 324,\n    columnNumber: 9\n  }, this);\n}\n_c2 = SettingsPage;\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"Settings\");\n$RefreshReg$(_c2, \"SettingsPage\");","map":{"version":3,"sources":["C:/Users/Michael/Documents/GitHub/fromagent/client/src/pages/settings.jsx"],"names":["React","useEffect","useState","Routes","Route","Link","useAuthState","UserManagementPage","GET_SECURITY","CHANGE_PASSWORD_PATH","GAPI_DELETE_USER","GAPI_GET_LINK","GAPI_GET_USER_TOKEN","USER_LOGOUT","SocketContext","socket","Settings","values","setValues","hasSecurity","setHasSecurity","security","setSecurity","AuthState","dispatchAuthState","popupWindow","question1","question2","exportToGoogleCalendar","emit","username","console","log","fetch","method","credentials","headers","body","JSON","stringify","then","res","ok","json","status","window","location","href","authUrl","catch","error","showlogout","document","getElementById","style","display","logoutfromGoogleCalendar","confirm","alert","message","type","targets","token","logout","handleSubmit","event","preventDefault","newPw","confirmNewPw","data","oldPassword","oldPw","newPassword","response","handleChange","e","target","name","value","on","Error","foundUser","securityQuestion1","securityQuestion2","height","permissionLevel","SettingsPage","props"],"mappings":"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","sourcesContent":["import React, { useEffect } from 'react';\r\nimport { useState } from 'react';\r\nimport { Routes, Route, Link } from 'react-router-dom';\r\nimport { useAuthState } from '../authentication/authcontext.jsx';\r\nimport UserManagementPage from './usermanagement.jsx';\r\nimport { GET_SECURITY,CHANGE_PASSWORD_PATH, GAPI_DELETE_USER, GAPI_GET_LINK, GAPI_GET_USER_TOKEN, USER_LOGOUT } from '../consts/api.const.js';\r\nimport { SocketContext, socket } from '../context/socket';\r\n\r\n\r\nfunction Settings() {\r\n\r\n\r\n    const [values, setValues] = useState({});\r\n    const [hasSecurity, setHasSecurity] = useState(false);\r\n    const [security, setSecurity] = useState({});\r\n    const [AuthState, dispatchAuthState] = useAuthState();\r\n    let popupWindow = null;\r\n\r\n    const question1 = [\r\n        \"你的第一個寵物名字是？\",\r\n        \"你的第一個車牌號碼是？\",\r\n        \"你的第一個電話號碼是？\",\r\n        \"你配偶的姓名是？\",\r\n        \"你母親的姓名是？\",\r\n        \"你父親的姓名是？\",\r\n    ]\r\n\r\n    const question2 = [\r\n        \"你的出生地是？\",\r\n        \"你的小學名字是？\",\r\n        \"你的學號（或職員編號）是？\",\r\n        \"對你影響最大的人名字是？\",\r\n        \"你的最喜歡的運動是？\",\r\n        \"你的最喜歡的食物是？\",\r\n    ];\r\n\r\n\r\n    const exportToGoogleCalendar = () => {\r\n        socket.emit(\"logingoogle\", AuthState.username);\r\n\t\tconsole.log(GAPI_GET_LINK);\r\n        fetch(GAPI_GET_LINK, {\r\n            method: \"POST\",\r\n            credentials: \"include\",\r\n            headers: {\r\n                \"Content-Type\": \"application/json\"\r\n            },\r\n            body: JSON.stringify(AuthState)\r\n        })\r\n            .then((res) => {\r\n                if (res.ok) {\r\n                    return (res.json());\r\n                }\r\n            })\r\n            .then((json) => {\r\n                if (json.status === \"success\") {\r\n                    window.location.href = json.authUrl;\r\n                }\r\n            })\r\n            .catch((error) => {\r\n                console.log(\"Error: \" + error);\r\n            })\r\n    }\r\n\t\r\n\tconst showlogout = () => {\r\n\t\tdocument.getElementById('logoutbtn').style.display=\"block\";\r\n\t\tdocument.getElementById('g-logout-more').style.display=\"none\";\r\n\t}\r\n\t\r\n    const logoutfromGoogleCalendar = () => {\r\n\t\tif (window.confirm(\"確定要登出Google嗎？\")) {\r\n\t\t\tfetch(GAPI_DELETE_USER, {\r\n\t\t\t\tmethod: \"DELETE\",\r\n\t\t\t\tcredentials: \"include\",\r\n\t\t\t\theaders: {\r\n\t\t\t\t\t\"Content-Type\": \"application/json\"\r\n\t\t\t\t},\r\n\t\t\t\tbody: JSON.stringify(AuthState)\r\n\t\t\t})\r\n            .then((res) => {\r\n                if (res.ok) {\r\n                    return (res.json());\r\n                }\r\n            })\r\n            .then((json) => {\r\n                window.alert(json.status + \": \" + json.message);\r\n                if (json.status === \"success\") {\r\n                    dispatchAuthState({\r\n                        type: \"UPDATE\",\r\n                        targets: {\r\n                            token: false\r\n                        }\r\n                    });\r\n                }\r\n            })\r\n            .catch((error) => {\r\n                console.log(\"Error: \" + error);\r\n            })\r\n\t\t}\r\n    }\r\n\r\n    const logout = () => {\r\n        fetch(USER_LOGOUT, {\r\n            method: \"POST\",\r\n            credentials: \"include\",\r\n            headers: {\r\n                \"Content-Type\": \"application/json\"\r\n            },\r\n            body: JSON.stringify(AuthState)\r\n        })\r\n            .then(res => {\r\n                if (res.ok) {\r\n                    return (res.json())\r\n                }\r\n            })\r\n            .then(\r\n                json => {\r\n                    if (json.status === \"success\") {\r\n                        alert(\"Successfully logged out\");\r\n                        dispatchAuthState({ type: \"LOGOUT\" });\r\n                    }\r\n                }\r\n            )\r\n            .catch(\r\n                error => {\r\n                    alert(error);\r\n                    console.log(error);\r\n                    return (error);\r\n                }\r\n            )\r\n    }\r\n\r\n    const handleSubmit = async (event) => {\r\n        event.preventDefault();\r\n        if (values.newPw !== values.confirmNewPw) {\r\n            alert(\"New password and confirm new password are not equal\");\r\n            return;\r\n        }\r\n        const data = {\r\n            username: AuthState.username,\r\n            oldPassword: values.oldPw,\r\n            newPassword: values.newPw\r\n        };\r\n        await fetch(CHANGE_PASSWORD_PATH, {\r\n            method: \"POST\",\r\n            headers: {\r\n                \"Content-Type\": \"application/json\"\r\n            },\r\n            body: JSON.stringify(data)\r\n        })\r\n            .then(\r\n                response => {\r\n                    if (response.ok) {\r\n                        return (response.json())\r\n                    }\r\n                }\r\n            )\r\n            .then(\r\n                res => {\r\n                    alert(res.status + \": \" + res.message);\r\n                }\r\n            )\r\n            .catch(\r\n                error => {\r\n                    alert(error);\r\n                }\r\n            )\r\n    }\r\n    const handleChange = (e) => {\r\n        setValues({\r\n            ...values,\r\n            [e.target.name]: e.target.value,\r\n        }\r\n        );\r\n    }\r\n\r\n    useEffect(() => {\r\n        socket.on(\"forceRefresh\", (data) => {\r\n            fetch(GAPI_GET_USER_TOKEN, {\r\n                method: \"POST\",\r\n                credentials: \"include\",\r\n                headers: {\r\n                    \"Content-Type\": \"application/json\"\r\n                }\r\n            })\r\n                .then(\r\n                    res => {\r\n                        if (res.ok) {\r\n                            return (res.json());\r\n                        }\r\n                    }\r\n                )\r\n                .then(\r\n                    json => {\r\n                        if (json.token === true) {\r\n                            dispatchAuthState({\r\n                                type: \"UPDATE\",\r\n                                targets: {\r\n                                    token: true\r\n                                }\r\n                            })\r\n                        }\r\n                    }\r\n                )\r\n                .catch(\r\n                    error => {\r\n                        console.log(Error(error));\r\n                    }\r\n                )\r\n        });\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        fetch(GET_SECURITY, {\r\n            method: \"POST\",\r\n            credentials: \"include\",\r\n            headers: {\r\n                \"Content-Type\": \"application/json\"\r\n            },\r\n            body: JSON.stringify({ AuthState})\r\n        })\r\n         .then( (res) => {\r\n            if (res.ok) {\r\n                return (res.json());\r\n            }\r\n        })\r\n         .then( (data) => {\r\n            if(data.status === \"success\"){\r\n                const foundUser = data.body.foundUser;\r\n                console.log(foundUser);\r\n                if(foundUser.securityQuestion1 != null && foundUser.securityQuestion2 != null ){\r\n                    console.log(\"has security\");\r\n                    setHasSecurity(true);\r\n                }\r\n            }\r\n            \r\n        })\r\n\r\n\r\n    }, []);\r\n\r\n    return (\r\n        <div className=\"bounceInAnimation d-flex justify-content-center\">\r\n            <div className='w-90 '>\r\n                <div className='my-3 w-100 d-flex justify-content-center align-items-center' style={{ height: \"100px\" }}>\r\n                    {!AuthState.token\r\n                        ?\r\n                        <div>\r\n                            <button className='btn-primary-outline google-btn' type=\"button\" onClick={exportToGoogleCalendar}>\r\n                                <img src=\"/google-btn.png\" />\r\n                            </button>\r\n                        </div>\r\n                        :\r\n\t\t\t\t\t\t<div align=\"center\">\r\n\t\t\t\t\t\t\t<h3>已成功連接Google</h3>\r\n\t\t\t\t\t\t\t<button onClick={showlogout} id=\"g-logout-more\"><h6>more <span>▼</span></h6></button>\r\n                        <button id=\"logoutbtn\" className='w-100 bg-light form-control shadow-sm border rounded h-50 google-btn' type=\"button\" onClick={logoutfromGoogleCalendar}>\r\n                            從 Google Calendar 登出\r\n                        </button>\r\n\t\t\t\t\t\t</div>\r\n                    }\r\n\r\n                </div>\r\n                \r\n                <div className='w-100 d-inline-flex flex-column align-items-center border p-3 pb-4 rounded'>\r\n                    <label className='w-100 text-start'>更改密碼</label>\r\n                    <form className='w-100 d-inline-flex flex-column align-items-center' onSubmit={handleSubmit}>\r\n                        <div className='form-group w-100 d-inline-flex flex-column align-items-center'>\r\n                            <input className='form-control shadow-sm my-2' type=\"password\" name=\"oldPw\" placeholder='舊密碼' onChange={handleChange} />\r\n                            <input className='form-control shadow-sm my-2' type=\"password\" name=\"newPw\" placeholder='新密碼' onChange={handleChange} />\r\n                            <input className='form-control shadow-sm my-2' type=\"password\" name=\"confirmNewPw\" placeholder='確認新密碼' onChange={handleChange} />\r\n                            <input className='mt-1 btn btn-outline-light w-100' type=\"submit\" value='更改' />\r\n                        </div>\r\n                    </form>\r\n                </div>\r\n                {  \r\n                    hasSecurity==false? <div className='w-80 d-inline-flex flex-column align-items-center border p-3 pb-4 rounded mt-3'>\r\n                    <label className='w-100 text-start'>！！設定密保問題！！</label>\r\n                    <form className='w-100 d-inline-flex flex-column align-items-center' onSubmit={handleSubmit}>\r\n                        <div className='form-group w-80 d-inline-flex flex-column align-items-center'>\r\n                            問題一：<select className='form-control shadow-sm my-2'>\r\n                                \r\n                            </select>\r\n                            <input className='form-control shadow-sm my-2' type=\"text\" name=\"answer1\" placeholder='答案' onChange={handleChange} />\r\n                            \r\n                        </div>\r\n                        <div className='form-group w-80 d-inline-flex flex-column align-items-center'>\r\n                            問題二：<select className='form-control shadow-sm my-2'>\r\n                                <option value=\"1\">你的出生地是？</option>\r\n                                <option value=\"2\">你的小學名是？</option>\r\n                                <option value=\"3\">你的學號（或職員編號）是？</option>\r\n                                <option value=\"3\">你玩過的第一個樂器是？</option>\r\n                                <option value=\"3\">你獲得的第一份工作是？</option>\r\n                                <option value=\"3\">對你影響最大的人名字是？</option>\r\n                            </select>\r\n                            <input className='form-control shadow-sm my-2' type=\"text\" name=\"answer2\" placeholder='答案' onChange={handleChange} />\r\n                            <input className='mt-1 btn btn-outline-light w-100' type=\"submit\" value='更改' />\r\n                        </div>\r\n                    </form>\r\n                </div>:null\r\n                  \r\n\r\n\r\n                }\r\n                \r\n                \r\n\r\n\r\n                <div className='w-100 container mt-3'>\r\n                    <div className=\"row\">\r\n                        {!!(AuthState.permissionLevel === 2) ?\r\n                            <Link to=\"usermanagement\" className='col w-100 p-0 me-1'>\r\n                                <button className='btn btn-outline-light w-100 '>進入員工管理頁面</button>\r\n                            </Link> : \"\"\r\n                        }\r\n                        <button className='col btn btn-light ms-1 p-0' type=\"button\" onClick={logout}>登出</button>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>);\r\n}\r\n\r\nexport default function SettingsPage(props) {\r\n    return (\r\n        <div>\r\n            <Routes>\r\n                <Route path=\"\" element={<Settings />} />\r\n                <Route path=\"usermanagement\" element={<UserManagementPage />} />\r\n            </Routes>\r\n        </div>\r\n    );\r\n}\r\n"]},"metadata":{},"sourceType":"module"}