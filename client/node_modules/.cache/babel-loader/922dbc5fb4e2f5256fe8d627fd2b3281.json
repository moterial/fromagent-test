{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Michael\\\\Documents\\\\GitHub\\\\fromagent\\\\client\\\\src\\\\pages\\\\settings.jsx\",\n    _s = $RefreshSig$();\n\nimport React, { useEffect } from 'react';\nimport { useState } from 'react';\nimport { Routes, Route, Link } from 'react-router-dom';\nimport { useAuthState } from '../authentication/authcontext.jsx';\nimport UserManagementPage from './usermanagement.jsx';\nimport { UPDATE_SECURITY, GET_SECURITY, CHANGE_PASSWORD_PATH, GAPI_DELETE_USER, GAPI_GET_LINK, GAPI_GET_USER_TOKEN, USER_LOGOUT } from '../consts/api.const.js';\nimport { SocketContext, socket } from '../context/socket';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nfunction Settings() {\n  _s();\n\n  const [values, setValues] = useState({});\n  const [hasSecurity, setHasSecurity] = useState(false);\n  const [security, setSecurity] = useState({\n    securityQuestion1: \"你的第一個寵物名字是？\",\n    securityQuestion2: \"你的出生地是？\"\n  });\n  const [AuthState, dispatchAuthState] = useAuthState();\n  let popupWindow = null;\n  const securityQuestion1 = [\"你的第一個寵物名字是？\", \"你的第一個車牌號碼是？\", \"你的第一個電話號碼是？\", \"你配偶的姓名是？\", \"你母親的姓名是？\", \"你父親的姓名是？\"];\n  const securityQuestion2 = [\"你的出生地是？\", \"你的小學名字是？\", \"你的學號（或職員編號）是？\", \"對你影響最大的人名字是？\", \"你的最喜歡的運動是？\", \"你的最喜歡的食物是？\"];\n\n  const exportToGoogleCalendar = () => {\n    socket.emit(\"logingoogle\", AuthState.username);\n    console.log(GAPI_GET_LINK);\n    fetch(GAPI_GET_LINK, {\n      method: \"POST\",\n      credentials: \"include\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify(AuthState)\n    }).then(res => {\n      if (res.ok) {\n        return res.json();\n      }\n    }).then(json => {\n      if (json.status === \"success\") {\n        window.location.href = json.authUrl;\n      }\n    }).catch(error => {\n      console.log(\"Error: \" + error);\n    });\n  };\n\n  const showlogout = () => {\n    document.getElementById('logoutbtn').style.display = \"block\";\n    document.getElementById('g-logout-more').style.display = \"none\";\n  };\n\n  const logoutfromGoogleCalendar = () => {\n    if (window.confirm(\"確定要登出Google嗎？\")) {\n      fetch(GAPI_DELETE_USER, {\n        method: \"DELETE\",\n        credentials: \"include\",\n        headers: {\n          \"Content-Type\": \"application/json\"\n        },\n        body: JSON.stringify(AuthState)\n      }).then(res => {\n        if (res.ok) {\n          return res.json();\n        }\n      }).then(json => {\n        window.alert(json.status + \": \" + json.message);\n\n        if (json.status === \"success\") {\n          dispatchAuthState({\n            type: \"UPDATE\",\n            targets: {\n              token: false\n            }\n          });\n        }\n      }).catch(error => {\n        console.log(\"Error: \" + error);\n      });\n    }\n  };\n\n  const logout = () => {\n    fetch(USER_LOGOUT, {\n      method: \"POST\",\n      credentials: \"include\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify(AuthState)\n    }).then(res => {\n      if (res.ok) {\n        return res.json();\n      }\n    }).then(json => {\n      if (json.status === \"success\") {\n        alert(\"Successfully logged out\");\n        dispatchAuthState({\n          type: \"LOGOUT\"\n        });\n      }\n    }).catch(error => {\n      alert(error);\n      console.log(error);\n      return error;\n    });\n  };\n\n  const handleSubmit = async event => {\n    event.preventDefault();\n\n    if (values.newPw !== values.confirmNewPw) {\n      alert(\"New password and confirm new password are not equal\");\n      return;\n    }\n\n    const data = {\n      username: AuthState.username,\n      oldPassword: values.oldPw,\n      newPassword: values.newPw\n    };\n    await fetch(CHANGE_PASSWORD_PATH, {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify(data)\n    }).then(response => {\n      if (response.ok) {\n        return response.json();\n      }\n    }).then(res => {\n      alert(res.status + \": \" + res.message);\n    }).catch(error => {\n      alert(error);\n    });\n  };\n\n  const handleChange = e => {\n    setValues({ ...values,\n      [e.target.name]: e.target.value\n    });\n  };\n\n  function handleQuestion1(e) {\n    console.log(e.target.value);\n    console.log(security);\n    setSecurity({ ...security,\n      securityQuestion1: e.target.value\n    });\n  }\n\n  function handleQuestion2(e) {\n    console.log(e.target.value);\n    console.log(security);\n    setSecurity({ ...security,\n      securityQuestion2: e.target.value\n    });\n  }\n\n  const handleSubmitSecurity = async e => {\n    e.preventDefault();\n    const answer1 = document.getElementById('answer1').value;\n    const answer2 = document.getElementById('answer2').value;\n    console.log(answer1);\n    console.log(answer2);\n\n    if (answer1 != \"\" || answer2 != \"\") {\n      setSecurity({ ...security,\n        securityAnswer1: answer1,\n        securityAnswer2: answer2\n      });\n      submitSecurity();\n    } else {\n      alert(\"請輸入密保答案\");\n    }\n  };\n\n  async function submitSecurity() {\n    await fetch(UPDATE_SECURITY, {\n      method: \"POST\",\n      credentials: \"include\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify({\n        AuthState: AuthState,\n        security: security\n      })\n    }).then(response => {\n      if (response.ok) {\n        return response.json();\n      }\n    }).then(res => {// window.location.reload();\n    }).catch(error => {\n      alert(error);\n    });\n  }\n\n  useEffect(() => {\n    socket.on(\"forceRefresh\", data => {\n      fetch(GAPI_GET_USER_TOKEN, {\n        method: \"POST\",\n        credentials: \"include\",\n        headers: {\n          \"Content-Type\": \"application/json\"\n        }\n      }).then(res => {\n        if (res.ok) {\n          return res.json();\n        }\n      }).then(json => {\n        if (json.token === true) {\n          dispatchAuthState({\n            type: \"UPDATE\",\n            targets: {\n              token: true\n            }\n          });\n        }\n      }).catch(error => {\n        console.log(Error(error));\n      });\n    });\n  }, []);\n  useEffect(() => {\n    fetch(GET_SECURITY, {\n      method: \"POST\",\n      credentials: \"include\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify({\n        AuthState\n      })\n    }).then(res => {\n      if (res.ok) {\n        return res.json();\n      }\n    }).then(data => {\n      if (data.status === \"success\") {\n        const foundUser = data.body.foundUser;\n        console.log(foundUser);\n\n        if (foundUser.securityQuestion1 != null && foundUser.securityQuestion2 != null) {\n          console.log(\"has security\");\n          setHasSecurity(true);\n        }\n      }\n    });\n  }, []);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"bounceInAnimation d-flex justify-content-center\",\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"w-90 \",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"my-3 w-100 d-flex justify-content-center align-items-center\",\n        style: {\n          height: \"100px\"\n        },\n        children: !AuthState.token ? /*#__PURE__*/_jsxDEV(\"div\", {\n          children: /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"btn-primary-outline google-btn\",\n            type: \"button\",\n            onClick: exportToGoogleCalendar,\n            children: /*#__PURE__*/_jsxDEV(\"img\", {\n              src: \"/google-btn.png\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 314,\n              columnNumber: 33\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 313,\n            columnNumber: 29\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 312,\n          columnNumber: 25\n        }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n          align: \"center\",\n          children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n            children: \"\\u5DF2\\u6210\\u529F\\u9023\\u63A5Google\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 319,\n            columnNumber: 8\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: showlogout,\n            id: \"g-logout-more\",\n            children: /*#__PURE__*/_jsxDEV(\"h6\", {\n              children: [\"more \", /*#__PURE__*/_jsxDEV(\"span\", {\n                children: \"\\u25BC\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 320,\n                columnNumber: 65\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 320,\n              columnNumber: 56\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 320,\n            columnNumber: 8\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            id: \"logoutbtn\",\n            className: \"w-100 bg-light form-control shadow-sm border rounded h-50 google-btn\",\n            type: \"button\",\n            onClick: logoutfromGoogleCalendar,\n            children: \"\\u5F9E Google Calendar \\u767B\\u51FA\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 321,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 318,\n          columnNumber: 7\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 309,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"w-100 d-inline-flex flex-column align-items-center border p-3 pb-4 rounded\",\n        children: [/*#__PURE__*/_jsxDEV(\"label\", {\n          className: \"w-100 text-start\",\n          children: \"\\u66F4\\u6539\\u5BC6\\u78BC\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 330,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"form\", {\n          className: \"w-100 d-inline-flex flex-column align-items-center\",\n          onSubmit: handleSubmit,\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"form-group w-100 d-inline-flex flex-column align-items-center\",\n            children: [/*#__PURE__*/_jsxDEV(\"input\", {\n              className: \"form-control shadow-sm my-2\",\n              type: \"password\",\n              name: \"oldPw\",\n              placeholder: \"\\u820A\\u5BC6\\u78BC\",\n              onChange: handleChange\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 333,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n              className: \"form-control shadow-sm my-2\",\n              type: \"password\",\n              name: \"newPw\",\n              placeholder: \"\\u65B0\\u5BC6\\u78BC\",\n              onChange: handleChange\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 334,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n              className: \"form-control shadow-sm my-2\",\n              type: \"password\",\n              name: \"confirmNewPw\",\n              placeholder: \"\\u78BA\\u8A8D\\u65B0\\u5BC6\\u78BC\",\n              onChange: handleChange\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 335,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n              className: \"mt-1 btn btn-outline-light w-100\",\n              type: \"submit\",\n              value: \"\\u66F4\\u6539\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 336,\n              columnNumber: 29\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 332,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 331,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 329,\n        columnNumber: 17\n      }, this), hasSecurity == false ? /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"w-80 d-inline-flex flex-column align-items-center border p-3 pb-4 rounded mt-3\",\n        children: [/*#__PURE__*/_jsxDEV(\"label\", {\n          className: \"w-100 text-start\",\n          children: \"\\uFF01\\uFF01\\u8A2D\\u5B9A\\u5BC6\\u4FDD\\u554F\\u984C\\uFF01\\uFF01\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 342,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"form\", {\n          className: \"w-100 d-inline-flex flex-column align-items-center\",\n          onSubmit: handleSubmitSecurity,\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"form-group w-80 d-inline-flex flex-column align-items-center\",\n            children: [\"\\u554F\\u984C\\u4E00\\uFF1A\", /*#__PURE__*/_jsxDEV(\"select\", {\n              className: \"form-control shadow-sm my-2\",\n              onChange: handleQuestion1,\n              children: securityQuestion1.map((item, index) => {\n                return /*#__PURE__*/_jsxDEV(\"option\", {\n                  value: item,\n                  children: item\n                }, index, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 349,\n                  columnNumber: 45\n                }, this);\n              })\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 345,\n              columnNumber: 33\n            }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n              className: \"form-control shadow-sm my-2\",\n              type: \"text\",\n              id: \"answer1\",\n              name: \"answer1\",\n              placeholder: \"\\u7B54\\u6848\",\n              onChange: handleChange\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 355,\n              columnNumber: 29\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 344,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"form-group w-80 d-inline-flex flex-column align-items-center\",\n            children: [\"\\u554F\\u984C\\u4E8C\\uFF1A\", /*#__PURE__*/_jsxDEV(\"select\", {\n              className: \"form-control shadow-sm my-2\",\n              onChange: handleQuestion2,\n              children: securityQuestion2.map((item, index) => {\n                return /*#__PURE__*/_jsxDEV(\"option\", {\n                  value: item,\n                  children: item\n                }, index, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 363,\n                  columnNumber: 45\n                }, this);\n              })\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 359,\n              columnNumber: 33\n            }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n              className: \"form-control shadow-sm my-2\",\n              type: \"text\",\n              id: \"answer2\",\n              name: \"answer2\",\n              placeholder: \"\\u7B54\\u6848\",\n              onChange: handleChange\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 368,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n              className: \"mt-1 btn btn-outline-light w-100\",\n              type: \"submit\",\n              value: \"\\u78BA\\u5B9A\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 369,\n              columnNumber: 29\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 358,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 343,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 341,\n        columnNumber: 41\n      }, this) : null, /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"w-100 container mt-3\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"row\",\n          children: [!!(AuthState.permissionLevel === 2) ? /*#__PURE__*/_jsxDEV(Link, {\n            to: \"usermanagement\",\n            className: \"col w-100 p-0 me-1\",\n            children: /*#__PURE__*/_jsxDEV(\"button\", {\n              className: \"btn btn-outline-light w-100 \",\n              children: \"\\u9032\\u5165\\u54E1\\u5DE5\\u7BA1\\u7406\\u9801\\u9762\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 385,\n              columnNumber: 33\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 384,\n            columnNumber: 29\n          }, this) : \"\", /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"col btn btn-light ms-1 p-0\",\n            type: \"button\",\n            onClick: logout,\n            children: \"\\u767B\\u51FA\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 388,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 382,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 381,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 308,\n      columnNumber: 13\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 307,\n    columnNumber: 9\n  }, this);\n}\n\n_s(Settings, \"vpW97amV1Ndk3D44e6X/vJ9CMpg=\", false, function () {\n  return [useAuthState];\n});\n\n_c = Settings;\nexport default function SettingsPage(props) {\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: /*#__PURE__*/_jsxDEV(Routes, {\n      children: [/*#__PURE__*/_jsxDEV(Route, {\n        path: \"\",\n        element: /*#__PURE__*/_jsxDEV(Settings, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 399,\n          columnNumber: 41\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 399,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(Route, {\n        path: \"usermanagement\",\n        element: /*#__PURE__*/_jsxDEV(UserManagementPage, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 400,\n          columnNumber: 55\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 400,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 398,\n      columnNumber: 13\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 397,\n    columnNumber: 9\n  }, this);\n}\n_c2 = SettingsPage;\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"Settings\");\n$RefreshReg$(_c2, \"SettingsPage\");","map":{"version":3,"sources":["C:/Users/Michael/Documents/GitHub/fromagent/client/src/pages/settings.jsx"],"names":["React","useEffect","useState","Routes","Route","Link","useAuthState","UserManagementPage","UPDATE_SECURITY","GET_SECURITY","CHANGE_PASSWORD_PATH","GAPI_DELETE_USER","GAPI_GET_LINK","GAPI_GET_USER_TOKEN","USER_LOGOUT","SocketContext","socket","Settings","values","setValues","hasSecurity","setHasSecurity","security","setSecurity","securityQuestion1","securityQuestion2","AuthState","dispatchAuthState","popupWindow","exportToGoogleCalendar","emit","username","console","log","fetch","method","credentials","headers","body","JSON","stringify","then","res","ok","json","status","window","location","href","authUrl","catch","error","showlogout","document","getElementById","style","display","logoutfromGoogleCalendar","confirm","alert","message","type","targets","token","logout","handleSubmit","event","preventDefault","newPw","confirmNewPw","data","oldPassword","oldPw","newPassword","response","handleChange","e","target","name","value","handleQuestion1","handleQuestion2","handleSubmitSecurity","answer1","answer2","securityAnswer1","securityAnswer2","submitSecurity","on","Error","foundUser","height","map","item","index","permissionLevel","SettingsPage","props"],"mappings":"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","sourcesContent":["import React, { useEffect } from 'react';\r\nimport { useState } from 'react';\r\nimport { Routes, Route, Link } from 'react-router-dom';\r\nimport { useAuthState } from '../authentication/authcontext.jsx';\r\nimport UserManagementPage from './usermanagement.jsx';\r\nimport { UPDATE_SECURITY, GET_SECURITY,CHANGE_PASSWORD_PATH, GAPI_DELETE_USER, GAPI_GET_LINK, GAPI_GET_USER_TOKEN, USER_LOGOUT } from '../consts/api.const.js';\r\nimport { SocketContext, socket } from '../context/socket';\r\n\r\n\r\nfunction Settings() {\r\n\r\n\r\n    const [values, setValues] = useState({});\r\n    const [hasSecurity, setHasSecurity] = useState(false);\r\n    const [security, setSecurity] = useState({\r\n        securityQuestion1: \"你的第一個寵物名字是？\",\r\n        securityQuestion2: \"你的出生地是？\",\r\n    });\r\n    const [AuthState, dispatchAuthState] = useAuthState();\r\n    let popupWindow = null;\r\n\r\n    const securityQuestion1 = [\r\n        \"你的第一個寵物名字是？\",\r\n        \"你的第一個車牌號碼是？\",\r\n        \"你的第一個電話號碼是？\",\r\n        \"你配偶的姓名是？\",\r\n        \"你母親的姓名是？\",\r\n        \"你父親的姓名是？\",\r\n    ]\r\n\r\n    const securityQuestion2 = [\r\n        \"你的出生地是？\",\r\n        \"你的小學名字是？\",\r\n        \"你的學號（或職員編號）是？\",\r\n        \"對你影響最大的人名字是？\",\r\n        \"你的最喜歡的運動是？\",\r\n        \"你的最喜歡的食物是？\",\r\n    ];\r\n\r\n\r\n    const exportToGoogleCalendar = () => {\r\n        socket.emit(\"logingoogle\", AuthState.username);\r\n\t\tconsole.log(GAPI_GET_LINK);\r\n        fetch(GAPI_GET_LINK, {\r\n            method: \"POST\",\r\n            credentials: \"include\",\r\n            headers: {\r\n                \"Content-Type\": \"application/json\"\r\n            },\r\n            body: JSON.stringify(AuthState)\r\n        })\r\n            .then((res) => {\r\n                if (res.ok) {\r\n                    return (res.json());\r\n                }\r\n            })\r\n            .then((json) => {\r\n                if (json.status === \"success\") {\r\n                    window.location.href = json.authUrl;\r\n                }\r\n            })\r\n            .catch((error) => {\r\n                console.log(\"Error: \" + error);\r\n            })\r\n    }\r\n\t\r\n\tconst showlogout = () => {\r\n\t\tdocument.getElementById('logoutbtn').style.display=\"block\";\r\n\t\tdocument.getElementById('g-logout-more').style.display=\"none\";\r\n\t}\r\n\t\r\n    const logoutfromGoogleCalendar = () => {\r\n\t\tif (window.confirm(\"確定要登出Google嗎？\")) {\r\n\t\t\tfetch(GAPI_DELETE_USER, {\r\n\t\t\t\tmethod: \"DELETE\",\r\n\t\t\t\tcredentials: \"include\",\r\n\t\t\t\theaders: {\r\n\t\t\t\t\t\"Content-Type\": \"application/json\"\r\n\t\t\t\t},\r\n\t\t\t\tbody: JSON.stringify(AuthState)\r\n\t\t\t})\r\n            .then((res) => {\r\n                if (res.ok) {\r\n                    return (res.json());\r\n                }\r\n            })\r\n            .then((json) => {\r\n                window.alert(json.status + \": \" + json.message);\r\n                if (json.status === \"success\") {\r\n                    dispatchAuthState({\r\n                        type: \"UPDATE\",\r\n                        targets: {\r\n                            token: false\r\n                        }\r\n                    });\r\n                }\r\n            })\r\n            .catch((error) => {\r\n                console.log(\"Error: \" + error);\r\n            })\r\n\t\t}\r\n    }\r\n\r\n    const logout = () => {\r\n        fetch(USER_LOGOUT, {\r\n            method: \"POST\",\r\n            credentials: \"include\",\r\n            headers: {\r\n                \"Content-Type\": \"application/json\"\r\n            },\r\n            body: JSON.stringify(AuthState)\r\n        })\r\n            .then(res => {\r\n                if (res.ok) {\r\n                    return (res.json())\r\n                }\r\n            })\r\n            .then(\r\n                json => {\r\n                    if (json.status === \"success\") {\r\n                        alert(\"Successfully logged out\");\r\n                        dispatchAuthState({ type: \"LOGOUT\" });\r\n                    }\r\n                }\r\n            )\r\n            .catch(\r\n                error => {\r\n                    alert(error);\r\n                    console.log(error);\r\n                    return (error);\r\n                }\r\n            )\r\n    }\r\n\r\n    const handleSubmit = async (event) => {\r\n        event.preventDefault();\r\n        if (values.newPw !== values.confirmNewPw) {\r\n            alert(\"New password and confirm new password are not equal\");\r\n            return;\r\n        }\r\n        const data = {\r\n            username: AuthState.username,\r\n            oldPassword: values.oldPw,\r\n            newPassword: values.newPw\r\n        };\r\n        await fetch(CHANGE_PASSWORD_PATH, {\r\n            method: \"POST\",\r\n            headers: {\r\n                \"Content-Type\": \"application/json\"\r\n            },\r\n            body: JSON.stringify(data)\r\n        })\r\n            .then(\r\n                response => {\r\n                    if (response.ok) {\r\n                        return (response.json())\r\n                    }\r\n                }\r\n            )\r\n            .then(\r\n                res => {\r\n                    alert(res.status + \": \" + res.message);\r\n                }\r\n            )\r\n            .catch(\r\n                error => {\r\n                    alert(error);\r\n                }\r\n            )\r\n    }\r\n    const handleChange = (e) => {\r\n        setValues({\r\n            ...values,\r\n            [e.target.name]: e.target.value,\r\n        }\r\n        );\r\n    }\r\n\r\n    function handleQuestion1(e) {\r\n        console.log(e.target.value);\r\n        console.log(security);\r\n        setSecurity({\r\n            ...security,\r\n            securityQuestion1: e.target.value\r\n        })\r\n    }\r\n\r\n    function handleQuestion2(e) {\r\n        console.log(e.target.value);\r\n        console.log(security);\r\n        setSecurity({\r\n            ...security,\r\n            securityQuestion2: e.target.value\r\n        })\r\n    }\r\n\r\n   const handleSubmitSecurity = async (e) =>{\r\n        e.preventDefault();\r\n        const answer1 = document.getElementById('answer1').value;\r\n        const answer2 = document.getElementById('answer2').value;\r\n        console.log(answer1);\r\n        console.log(answer2);\r\n        if(answer1 != \"\" || answer2 != \"\"){\r\n            setSecurity({\r\n                ...security,\r\n                securityAnswer1: answer1,\r\n                securityAnswer2: answer2\r\n            })\r\n            submitSecurity();\r\n            \r\n        }\r\n        else{\r\n            alert(\"請輸入密保答案\");\r\n        }\r\n    }\r\n\r\n    async function submitSecurity(){\r\n        await fetch(UPDATE_SECURITY, {\r\n            method: \"POST\",\r\n            credentials: \"include\",\r\n            headers: {\r\n                \"Content-Type\": \"application/json\"\r\n            },\r\n            body: JSON.stringify({AuthState: AuthState, security: security})\r\n        })\r\n        .then(response => {\r\n            if (response.ok) {\r\n                    return (response.json())\r\n                }\r\n        })\r\n        .then(res => {\r\n            \r\n            // window.location.reload();\r\n        })\r\n        .catch(error => {\r\n            alert(error);\r\n        })\r\n    }\r\n\r\n\r\n    useEffect(() => {\r\n        socket.on(\"forceRefresh\", (data) => {\r\n            fetch(GAPI_GET_USER_TOKEN, {\r\n                method: \"POST\",\r\n                credentials: \"include\",\r\n                headers: {\r\n                    \"Content-Type\": \"application/json\"\r\n                }\r\n            })\r\n                .then(\r\n                    res => {\r\n                        if (res.ok) {\r\n                            return (res.json());\r\n                        }\r\n                    }\r\n                )\r\n                .then(\r\n                    json => {\r\n                        if (json.token === true) {\r\n                            dispatchAuthState({\r\n                                type: \"UPDATE\",\r\n                                targets: {\r\n                                    token: true\r\n                                }\r\n                            })\r\n                        }\r\n                    }\r\n                )\r\n                .catch(\r\n                    error => {\r\n                        console.log(Error(error));\r\n                    }\r\n                )\r\n        });\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        fetch(GET_SECURITY, {\r\n            method: \"POST\",\r\n            credentials: \"include\",\r\n            headers: {\r\n                \"Content-Type\": \"application/json\"\r\n            },\r\n            body: JSON.stringify({ AuthState})\r\n        })\r\n         .then( (res) => {\r\n            if (res.ok) {\r\n                return (res.json());\r\n            }\r\n        })\r\n         .then( (data) => {\r\n            if(data.status === \"success\"){\r\n                const foundUser = data.body.foundUser;\r\n                console.log(foundUser);\r\n                if(foundUser.securityQuestion1 != null && foundUser.securityQuestion2 != null ){\r\n                    console.log(\"has security\");\r\n                    setHasSecurity(true);\r\n                }\r\n            }\r\n            \r\n        })\r\n\r\n\r\n    }, []);\r\n\r\n    return (\r\n        <div className=\"bounceInAnimation d-flex justify-content-center\">\r\n            <div className='w-90 '>\r\n                <div className='my-3 w-100 d-flex justify-content-center align-items-center' style={{ height: \"100px\" }}>\r\n                    {!AuthState.token\r\n                        ?\r\n                        <div>\r\n                            <button className='btn-primary-outline google-btn' type=\"button\" onClick={exportToGoogleCalendar}>\r\n                                <img src=\"/google-btn.png\" />\r\n                            </button>\r\n                        </div>\r\n                        :\r\n\t\t\t\t\t\t<div align=\"center\">\r\n\t\t\t\t\t\t\t<h3>已成功連接Google</h3>\r\n\t\t\t\t\t\t\t<button onClick={showlogout} id=\"g-logout-more\"><h6>more <span>▼</span></h6></button>\r\n                        <button id=\"logoutbtn\" className='w-100 bg-light form-control shadow-sm border rounded h-50 google-btn' type=\"button\" onClick={logoutfromGoogleCalendar}>\r\n                            從 Google Calendar 登出\r\n                        </button>\r\n\t\t\t\t\t\t</div>\r\n                    }\r\n\r\n                </div>\r\n                \r\n                <div className='w-100 d-inline-flex flex-column align-items-center border p-3 pb-4 rounded'>\r\n                    <label className='w-100 text-start'>更改密碼</label>\r\n                    <form className='w-100 d-inline-flex flex-column align-items-center' onSubmit={handleSubmit}>\r\n                        <div className='form-group w-100 d-inline-flex flex-column align-items-center'>\r\n                            <input className='form-control shadow-sm my-2' type=\"password\" name=\"oldPw\" placeholder='舊密碼' onChange={handleChange} />\r\n                            <input className='form-control shadow-sm my-2' type=\"password\" name=\"newPw\" placeholder='新密碼' onChange={handleChange} />\r\n                            <input className='form-control shadow-sm my-2' type=\"password\" name=\"confirmNewPw\" placeholder='確認新密碼' onChange={handleChange} />\r\n                            <input className='mt-1 btn btn-outline-light w-100' type=\"submit\" value='更改' />\r\n                        </div>\r\n                    </form>\r\n                </div>\r\n                {  \r\n                    hasSecurity==false? <div className='w-80 d-inline-flex flex-column align-items-center border p-3 pb-4 rounded mt-3'>\r\n                    <label className='w-100 text-start'>！！設定密保問題！！</label>\r\n                    <form className='w-100 d-inline-flex flex-column align-items-center' onSubmit={handleSubmitSecurity}>\r\n                        <div className='form-group w-80 d-inline-flex flex-column align-items-center'>\r\n                            問題一：<select className='form-control shadow-sm my-2' onChange={handleQuestion1}>\r\n                                {\r\n                                    securityQuestion1.map((item, index) => {\r\n                                        return (\r\n                                            <option key={index} value={item}>{item}</option>\r\n                                        )\r\n                                    })\r\n                                }\r\n                                \r\n                            </select>\r\n                            <input className='form-control shadow-sm my-2' type=\"text\" id=\"answer1\" name=\"answer1\" placeholder='答案' onChange={handleChange} />\r\n                            \r\n                        </div>\r\n                        <div className='form-group w-80 d-inline-flex flex-column align-items-center'>\r\n                            問題二：<select className='form-control shadow-sm my-2' onChange={handleQuestion2}>\r\n                                {\r\n                                    securityQuestion2.map((item, index) => {\r\n                                        return (\r\n                                            <option key={index} value={item}>{item}</option>\r\n                                        )\r\n                                    })\r\n                                }\r\n                            </select>\r\n                            <input className='form-control shadow-sm my-2' type=\"text\" id=\"answer2\" name=\"answer2\" placeholder='答案' onChange={handleChange} />\r\n                            <input className='mt-1 btn btn-outline-light w-100' type=\"submit\" value='確定' />\r\n                        </div>\r\n                    </form>\r\n                </div>:null\r\n                  \r\n\r\n\r\n                }\r\n                \r\n                \r\n\r\n\r\n                <div className='w-100 container mt-3'>\r\n                    <div className=\"row\">\r\n                        {!!(AuthState.permissionLevel === 2) ?\r\n                            <Link to=\"usermanagement\" className='col w-100 p-0 me-1'>\r\n                                <button className='btn btn-outline-light w-100 '>進入員工管理頁面</button>\r\n                            </Link> : \"\"\r\n                        }\r\n                        <button className='col btn btn-light ms-1 p-0' type=\"button\" onClick={logout}>登出</button>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>);\r\n}\r\n\r\nexport default function SettingsPage(props) {\r\n    return (\r\n        <div>\r\n            <Routes>\r\n                <Route path=\"\" element={<Settings />} />\r\n                <Route path=\"usermanagement\" element={<UserManagementPage />} />\r\n            </Routes>\r\n        </div>\r\n    );\r\n}\r\n"]},"metadata":{},"sourceType":"module"}